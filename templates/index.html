<!doctype html>
<title>HBNI Audio Archive</title>

<head>
    <script src="/static/jquery.js"></script>
    <script src="/static/bootstrap.js"></script>
    <script src="/static/bootstrap-select.js"></script>
    <script src="/static/materialize.min.js"></script>
    <link type="text/css" href="/static/bootstrap.css" rel="stylesheet" />
    <link type="text/css" href="/static/bootstrap-select.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/materialize.min.css">
    <link rel="stylesheet" href="/static/icon.css">
    <link type="text/css" rel="stylesheet" href='/static/main.css' />
    <link rel="icon" href="/static/icon.png">

    <meta property="og:title" content="HBNI Audio Archive" />
    <meta property="og:url" content="http://audioarchives.hbni.net" />
    <meta property="og:image" content="http://audioarchives.hbni.net/static/hbnilogo.png" />
    <meta property="og:description" content="Download or relisten to previously broadcasted streams." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
    <ul id="home-slide-out" class="side-nav">
        <li>
            <div class="user-view">
                <div class="col s9 push-s3">
                    <h4 style="font-size: 18px; text-align: left; margin: 0; margin-top: 10px;">HBNI Audio Streaming
                        Archive
                    </h4>
                    <p style="font-size: 11px; line-height: 10px; margin-top: 10px;">Download or relisten to previously
                        broadcasted streams.</p>
                </div>
            </div>
        </li>
        <li>
            <div class="divider"></div>
        </li>
        <li><a class="subheader">Developed by the TheCodingJ's</a></li>
        <li><a href="http://audioarchives.hbni.net/faq"><i
                    class="material-icons left">question_answer</i>Frequently Asked Questions</a></p>
        </li>
        <li><a class="subheader">Get the HBNI Audio App on</a></li>
        <li><a href="https://github.com/TheCodingJsoftware/HBNI-Audio-Stream-Listener/releases"><i
                    class="material-icons left">computer</i>Desktop</a></p>
        </li>
        <li><a href="https://apps.apple.com/ca/app/hbni-audio-streaming/id1611672333"><i
                    class="material-icons left">apple</i>Apple</a></p>
        </li>
        <li><a href="https://play.google.com/store/apps/details?id=com.thecodingjsoftware.hutteritechurch"><i
                    class="material-icons left">android</i>Android</a></p>
        </li>
        <footer class="page-footer">
            <div class="container" style="padding: 0;">
                <p class="grey-text text-lighten-4" style="line-height: 15px;">For questions, comments, or
                    concerns about this serivce please email: <a
                        href="mailto:jared@pinelandfarms.ca">jared@pinelandfarms.ca</a></p>
            </div>
            <div class="footer-copyright">
                <div class="container" style="padding: 0;">
                    Â© 2022 TheCodingJ'software
                </div>
            </div>
        </footer>
    </ul>
    <nav>
        <div class="nav-wrapper">
            <a class="brand-logo center">HBNI Audio Streaming Archive</a>
            <ul id="nav-mobile" class="left">
                <li><a data-activates="home-slide-out" class="button-collapse"
                        style="padding: 0; display: block; position: fixed; top: 0; left: 0;"><i class="material-icons"
                            style="font-size: 36px;">menu</i></a>
                </li>
            </ul>
        </div>
    </nav>
    <br>
    <br>
    <br>
    <br>
    <div id="downloads">
        <br>
        <div class="search-box">
            <form class="search-form">
                <input type="text" placeholder="Search for broadcasts" id="search" autocomplete="on">
            </form>
        </div>
        <div style="text-align: center; ">
            <div class="preloader-wrapper big active" id="loader">
                <div class="spinner-layer spinner-aqua-only">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div id="noTextMessage"></div>
        <br>
        <div class="downloads_container">
            {% for groupName in downloadableRecordings %}
            <details {% if loop.first %}open{% endif %}>
                <summary>{{ groupName }}</summary>
                <div class="scroll">
                    {% for itemName, itemData in downloadableRecordings[groupName].items() %}
                    <a class="waves-effect waves-light btn" target="_blank" onclick="buttonPressed('{{ itemName }}')" href="{{ itemData['downloadLink'] }}">
                        <i class="material-icons left">
                            {% if "play_recording" in itemData['downloadLink'] %}
                            play_arrow
                            {% elif "mega" in itemData['downloadLink'] or "google" in itemData['downloadLink'] %}
                            cloud
                            {% else %}
                            download
                            {% endif %}
                        </i>{{ itemName }}
                    </a>
                    {% endfor %}
                </div>
            </details>
            {% endfor %}
        </div>
        {% if recording_status %}
        <details open>
            <summary>Currently Recording</summary>
            <div class="scroll">
                {% for host, host_data in recording_status.items() %}
                <a class="waves-effect waves-light btn" target="_blank" href="{{ host_data["link"] }}">
                    <i class="material-icons left">
                        record_voice_over
                    </i>{{host.replace("/", "").title()}} - {{ host_data["description"] }} - {{ host_data["starting_time"] }} - {{ host_data["length"] }}
                </a>
                {% endfor %}
            </div>
        </details>
        {% endif %}
    </div>
</body>

</html>

<script>
    $(document).ready(function () {
        function resetState() {
            $('.downloads_container details:first').prop('open', true);
            $('.downloads_container details:not(:first)').prop('open', false);
            $('.downloads_container .btn').show();
            $('.downloads_container details').show();
            $('#noTextMessage').html("");
        }

        resetState();
        $('#search').on('input', function () {
            var originalSongButtons = $(".waves-effect.waves-light.btn");
            var originalDetails = $("details");
            var downloadsPage = $("#downloads");
            var searchText = $(this).val().trim().toLowerCase();

            if (searchText === '') {
                resetState();
                return;
            }

            // Open all detail views when searching for text
            $('.downloads_container details').prop('open', true);

            var filteredFiles = originalSongButtons.filter(function () {
                return $(this).text().toLowerCase().includes(searchText);
            });

            originalSongButtons.hide();
            filteredFiles.show();
            originalDetails.each(function () {
                var details = $(this);
                var detailFilteredElements = details.find(".waves-effect.waves-light.btn").filter(function () {
                    return $(this).css("display") == "block";
                });
                if (detailFilteredElements.length > 0) {
                    details.show();
                } else {
                    details.hide();
                }
            });
            if (downloadsPage.find('details:visible').length == 0) {
                $('#noTextMessage').html("No broadcasts found with this name");
            } else {
                $('#noTextMessage').html("");
            }
        });
        $('.button-collapse').sideNav({
            menuWidth: 300, // Default is 300
            edge: 'left', // Choose the horizontal origin
            closeOnClick: true, // Closes side-nav on <a> clicks, useful for Angular/Meteor
            draggable: true, // Choose whether you can drag to open on touch screens,
        });
    });
    document.addEventListener("DOMContentLoaded", function () {
        $('#loader').hide();
    });
    function buttonPressed(itemName) {
        fetch('/button_pressed', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({itemName: itemName})
        }).then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Something went wrong');
        }).catch(error => console.error('Error:', error));
    }
</script>
